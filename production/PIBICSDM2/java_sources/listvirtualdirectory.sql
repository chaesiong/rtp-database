CREATE JAVA SOURCE NAMED "PIBICSDM2"."LISTVIRTUALDIRECTORY" AS 
 // Import required classes.import java.io.*;import java.security.AccessControlException;import java.sql.*;import java.util.Arrays;import oracle.sql.driver.*;import oracle.sql.ArrayDescriptor;import oracle.sql.ARRAY;       // Define the class.    public class ListVirtualDirectory {        // Define the method.        public static ARRAY getList(String path) throws SQLException {                // Declare variable as a null, required because of try-catch block.        ARRAY listed = null;                // Define a connection (this is for Oracle 11g).        Connection conn = DriverManager.getConnection("jdbc:default:connection:");        // Use a try-catch block to trap a Java permission error on the directory.        try {            // Declare a class with the file list.            File directory = new File(path);                                // Declare a mapping to the schema-level SQL collection type.            ArrayDescriptor arrayDescriptor = new ArrayDescriptor("FILE_LIST",conn);                                // Translate the Java String[] to the Oracle SQL collection type.            listed = new ARRAY(arrayDescriptor,conn,((Object[]) directory.list()));        }catch (AccessControlException e) {            throw new AccessControlException("Directory permissions restricted.");        }        return listed;    }}
/
